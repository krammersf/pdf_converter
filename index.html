<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>PDF ‚Üí Base64 em blocos + Google Sheets</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 20px; }
    textarea { width: 100%; height: 180px; margin-top: 10px; }
    button { margin: 5px 5px 10px 0; }
    .bloco { border: 1px solid #ccc; padding: 10px; margin-top: 10px; background: #f9f9f9; }
  </style>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body onload="handleClientLoad()">

  <h2>üîÅ PDF ‚Üí Base64 em Blocos + Google Sheets</h2>

  <h3>üì§ PDF ‚Üí Base64 em blocos</h3>
  <input type="file" id="pdfInput" accept=".pdf" /><br />
  <button onclick="converterPDFparaBase64()">Converter e Dividir + Enviar para Sheets</button>
  <button onclick="limparBlocos()">Limpar</button>
  <div id="blocosContainer"></div>

  <script>
    // Configura√ß√µes da API Google
    const CLIENT_ID = 'SEU_CLIENT_ID.apps.googleusercontent.com';
    const API_KEY = 'SUA_API_KEY';
    const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
    const SPREADSHEET_ID = 'ID_DA_SUA_PLANILHA';

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        scope: SCOPES,
        discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
      }).then(() => {
        if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {
          gapi.auth2.getAuthInstance().signIn();
        }
      });
    }

    function converterPDFparaBase64() {
      const file = document.getElementById('pdfInput').files[0];
      if (!file) {
        alert('Selecione um arquivo PDF.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function () {
        const base64 = reader.result.split(',')[1];
        const blocoTam = 50000;
        const blocos = [];

        for (let i = 0; i < base64.length; i += blocoTam) {
          blocos.push(base64.slice(i, i + blocoTam));
        }

        const container = document.getElementById('blocosContainer');
        container.innerHTML = '';

        blocos.forEach((bloco, index) => {
          const div = document.createElement('div');
          div.className = 'bloco';

          const textAreaId = `blocoText_${index}`;

          div.innerHTML = `
            <b>Bloco ${index + 1}</b><br>
            <textarea id="${textAreaId}" readonly>${bloco}</textarea><br>
          `;

          container.appendChild(div);
        });

        // Enviar blocos para Google Sheets
        enviarBlocosParaSheets(blocos);
      };

      reader.readAsDataURL(file);
    }

    function limparBlocos() {
      document.getElementById('blocosContainer').innerHTML = '';
    }

    // Fun√ß√£o para enviar blocos para Google Sheets
    function enviarBlocosParaSheets(blocos) {
      const values = blocos.map(bloco => [bloco]); // cada bloco numa linha, coluna A

      const body = {
        values: values,
      };

      gapi.client.sheets.spreadsheets.values
        .append({
          spreadsheetId: SPREADSHEET_ID,
          range: 'A1',
          valueInputOption: 'RAW',
          insertDataOption: 'INSERT_ROWS',
          resource: body,
        })
        .then(
          (response) => {
            console.log(`${response.result.updates.updatedRows} linhas inseridas.`);
            alert('Blocos enviados para Google Sheets com sucesso!');
          },
          (error) => {
            console.error(error);
            alert('Erro ao enviar para Google Sheets. Veja o console para detalhes.');
          }
        );
    }
  </script>
</body>
</html>
